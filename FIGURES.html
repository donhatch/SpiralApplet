<!DOCTYPE html>
<html>
<head>
    <!--
        TODO: text highlights when dragging, make it not do that
        TODO: make it not change into a text cursor when dragging? (when on text too)
        TODO: make it draggable even when in other document!

        TODO: more descriptive than "dragging thing with"
        TODO: constraints?
        TODO: show values somewhere on screen instead of console log
        TODO: make drag handle bigger on hover

        TODO: dragging 0 should change global translate
        TODO: dragging p should change global scale
        TODO: doesn't detect mouse clicks in firefox?

        TODO: parametrize the figure, going to use it 3 times
              Figure 5:  Inductive step case 2: Dudley walks from _d to ^d.
                d0 = .745 .415
                d1 = .8 .6
                nNeighbors=2
                don't show dotted lines
                don't show arcs
                don't show dhat stuff
              Figure 6: Proving (^B) in inductive step case 2
                d0 = .6 .2
                d1 = .8 .6
                nNeighbors=0
                show dotted lines
                don't show arcs
                don't show dhat stuff
              Figure 7: Proving (^C) in inductive step case 2
                p = 0 1.42
                d0 = .635 .34
                d1 = .855 1.175
                nNeighbors=0
                don't show dotted lines
                show arcs
                show dhat stuff


    -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Figures for The Spiral Moment Lemma: There's No Single-Exit Lagoon</title>
    <style type="text/css">
        body {font-size:large;}
        /* "smaller" seems to mean 80% */
        #theSource {font-size: 58.119653701782230115213678800500929355622%;} /* minimum that stays black instead of turning gray */

        div.figure {
            width:60%; /* XXX ARGH! don't want to have to do this! */
            margin:auto;
            outline: 1px dashed #d0d0d0;
        }
        svg.figure {
            outline: 1px dashed black;
        }

        text {
            /* make it so the text doesn't get highlighted
               if the mouse is over it during dragging,
               since that got pretty distracting.
               the user-select one is commented out because it provokes a warning in firefox.
               */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            /* user-select: none; */

            /* fill: green; */
        }


        /* TODO: figure out how to hard code this */
        .assertFail:before {  
            color: red;  
            font-weight: bold;  
        }  

    </style>

    <!-- 1.9.1 provokes warnings in firefox:
         Unknown property 'box-sizing'. Declaration dropped.
         :-(
    -->
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>


    <script>
	// make $ not be an alias for jQuery
        // since I think that's ridiculous
        jQuery.noConflict();
    </script>

    <script src="ZeroClipboard.js"></script>

    <script src="initFigureInteraction.js"></script> <!-- do NOT self-close, that causes weirdness -->

    <script>
        jQuery(document).ready(function() {
            console.log("in jquery document-ready function!");

            var templateDiv = jQuery('#figureTemplateDiv');
            var templateSVG = templateDiv.children();
            var theSource = jQuery('#theSource');
            var theButton = jQuery('#copy-button');

            var figure5div = jQuery('#figure5div');
            var figure6div = jQuery('#figure6div');
            var figure7div = jQuery('#figure7div');

            var figureDivs = jQuery([figure5div[0],figure6div[0],figure7div[0]]);

            // replace the contents of each figure div
            // with a cloned copy of the template svg.
            figureDivs.empty().append(templateSVG.clone()); // XXX why doesn't this work? shouldn't it be same as the other?


            var globals = function() {
                answer = [];
                for (var key in window)
                    answer.push(key);
                return answer;
            }

            // return all values in array a that are not in array b
            var difference = function(a,b) {
                var bSet = Object(); // 
                for (var i in b)
                    bSet[b[i]] = true;
                var answer = []
                for (var i in a)
                    if (!(a[i] in bSet))
                        answer.push(a[i]);
                return answer;
            };

            var globals0 = globals();
            console.log("number of globals 0: = ",globals0.length);

            initFigureInteraction(figure5div, function() {
            });

            var globals1 = globals();
            console.log("after init figure5: globals = ",globals1.length);
            console.log("added items: ",difference(globals1,globals0));
            console.log("deleted items: ",difference(globals0,globals1));

            initFigureInteraction(figure6div, function() {
            });

            var globals2 = globals();
            console.log("after init figure6: globals = ",globals2.length);
            console.log("added items: ",difference(globals2,globals1));
            console.log("deleted items: ",difference(globals1,globals2));

            initFigureInteraction(figure7div, function() {
            });

            var globals3 = globals();
            console.log("after init figure7: globals = ",globals3.length);

            initFigureInteraction(templateDiv, function() {
                // this gets called when the svg source changes
                theSource.text("    "+jQuery.trim(templateDiv[0].innerHTML));
                console.log("setting text for copy-to-clipboard button");
                theButton.attr('data-clipboard-text', "    "+jQuery.trim(templateDiv[0].innerHTML));
            });

            var globals4 = globals();
            console.log("after init template: globals = ",globals4.length);

            // NOTE ZeroClipboard only works over a web server
            // (not via file://).
            // To start a web server:
            //     python -m SimpleHTTPServer
            var clip = new ZeroClipboard( document.getElementById("copy-button"), { moviePath: "ZeroClipboard.swf" } );
            clip.on('complete', function(client,args) {
                console.log("Copied "+theButton.attr('data-clipboard-text').length+" bytes of text to clipboard");
            });

            console.log("out jquery document-ready function!");
        }); // jquery document ready function
    </script>
</head>
<body>
<p>
<ul id="assertOutputList"></ul>  
<p>
<!-- ======================================================================== -->
<hr>
<div id="figure5div" class="figure" width="450" height="330">
    (placeholder -- this should get replaced by the figure 5 svg)
</div>
<br>
Figure 5
<hr>
<div id="figure6div" class="figure" width="450" height="330">
    (placeholder -- this should get replaced by the figure 6 svg)
</div>
<br>
Figure 6
<hr>
<div id="figure7div" class="figure" width="450" height="330">
    (placeholder -- this should get replaced by the figure 7 svg)
</div>
<br>
Figure 7
<hr>
<div id="figureTemplateDiv" class="figure" width="450" height="330">
    <svg class="figureTemplate" xmlns="http://www.w3.org/2000/svg" version="1.1" width="450" height="330">
        <!-- 1 unit = 20 pixels -->
        <g class="theGraphic" transform="translate(150,300) scale(200,-200)">
           
            <!-- note, the super-light gray here might not be appropriate for printing or most displays; my display maybe isn't like most -->
            <path class="yAxis" vector-effect="non-scaling-stroke" style="stroke:#f0f0f0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 1 L 0 0"></path>

            <path class="m1arc" vector-effect="non-scaling-stroke" style="stroke:#e0e0e0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 0 L 0.056920997883030844 0.01897366596101028 A0.06000000000000002,0.06000000000000002 0 0,1 0,0.06000000000000002 L 0 0"></path>
            <path class="m2arc" vector-effect="non-scaling-stroke" style="stroke:#e0e0e0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 0 L 0.19200000000000006 0.14400000000000007 A0.24000000000000007,0.24000000000000007 0 0,1 0,0.24000000000000007 L 0 0"></path>
            <path class="m3arc" vector-effect="non-scaling-stroke" style="stroke:#e0e0e0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 0.10000000000000003 L 0.056920997883030844 0.1189736659610103 A0.06000000000000002,0.06000000000000002 0 0,1 0,0.16000000000000006 L 0 0.10000000000000003"></path>

            <path class="orthoDottedPath" vector-effect="non-scaling-stroke" style="stroke:#808080; stroke-width:2; stroke-dasharray:5,5; fill: none; stroke-opacity:1" d="M 0 0 L 0.8 0 L 0.8 0.6000000000000001 M 0 0 L 0.6000000000000001 0 L 0.6000000000000001 0.2"></path>
            <path class="dhatDottedPath" vector-effect="non-scaling-stroke" style="stroke:#808080; stroke-width:2; stroke-dasharray:5,5; fill: none; stroke-opacity:1" d="M 0.8 0.6000000000000001 L 0.6000000000000001 0.5333333333333334"></path>
            <path class="dhatSolidPath" vector-effect="non-scaling-stroke" style="stroke:#8080ff; stroke-width:2; fill: none; stroke-opacity:1" d="M 0.6000000000000001 0.2 L 0.6000000000000001 0.5333333333333334 L 0 0"></path>


            <path class="dudleyNeighborsPath" stroke-miterlimit="100000" vector-effect="non-scaling-stroke" style="stroke:rgb(192,192,255); stroke-width: 2; fill: none; stroke-opacity:1" d=" M 0.8 0.6000000000000001 L 0.9000000000000001 1.3000000000000003 L 0 0 M 0.6000000000000001 0.2 L 0.4000000000000001 -5.551115123125783e-17 L 0 0"></path>
            <path class="dudleyMainPath" vector-effect="non-scaling-stroke" style="stroke: blue; stroke-width: 4; fill: none; stroke-miterlimit:1.414" d="M 0 0 L 0.6000000000000001 0.2 L 0.8 0.6000000000000001 L 0 0"></path>
            <path class="priscillaNeighborsPath" vector-effect="non-scaling-stroke" style="stroke:rgb(255,192,192); stroke-width: 2; fill: none; stroke-opacity:1" d=" M -2.160000000000001 2.88 L -0.6000000000000003 1.8 L 0.3899494936611664 1.6585786437626908 M 0.3630852169962633 0.3035814496704034 L 0.1666666666666667 0.49999999999999994 L 0.16666666666666669 0.22222222222222215"></path>
            <path class="priscillaMainPath" vector-effect="non-scaling-stroke" style="stroke: red; stroke-width: 2; fill: none; stroke-opacity:.2" d="M 0.1666666666666667 0.49999999999999994 L 0 1 L -0.6000000000000003 1.8 M 0 1 L 0.47140452079103173 0.7642977396044842"></path>

                
            <g class="ptransform" transform="translate(0,1)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle class="priscillaPoint" cx="0" cy="0" r="4" style="stroke-width:2; stroke: red; fill: white;"></circle>
                    <g transform="translate(10,-10)">
                        <text>p</text>
                    </g>
                </g>
            </g>
            <g transform="translate(0,0)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(-10,15)">
                        <text>0</text>
                    </g>
                </g>
            </g>

            <g class="dhattransform" transform="translate(0.6000000000000001,0.5333333333333334)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:none;fill:blue"></circle>
                    <g transform="translate(-15,0)">
                        <text class="d0text">
                            <tspan x="0" y="0">d</tspan>
                            <tspan x="1" y="-9">^</tspan>
                        </text>
                    </g>
                </g>
            </g>
            <g class="d0transform" transform="translate(0.6000000000000001,0.2)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(5,10)">
                        <text class="d0text">
                            <tspan x="0" y="0">d</tspan>
                            <tspan x="0" y="0">_</tspan>
                        </text>
                    </g>
                </g>
            </g>
            <g class="xd0transform" transform="translate(0.6000000000000001,0)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <g transform="translate(-15,17)">
                        <text class="xd0text">
                            <tspan>x</tspan><tspan dy="5" font-size="70%">d</tspan>
                            <tspan x="0" y="3">_</tspan>
                            <tspan x="6" y="3">_</tspan>
                        </text>
                    </g>
                </g>
            </g>

            <g class="d1transform" transform="translate(0.8,0.6000000000000001)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(10,5)">
                        <text class="d1text">
                            <tspan x="0" y="0">d</tspan>
                            <tspan x="0" y="-19">_</tspan>
                        </text>
                    </g>
                </g>
            </g>
            <g class="xd1transform" transform="translate(0.8,0)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <g transform="translate(0,17)">
                        <text class="xd1text">
                            <tspan>x</tspan><tspan dy="5" font-size="70%">d</tspan>
                            <tspan x="0" y="-15">_</tspan>
                            <tspan x="6" y="-15">_</tspan>
                        </text>
                    </g>
                </g>
            </g>
        </g>
    </svg>
</div>
<br>
Figures 5,6,7 template (all elements that appear in any of them).
<hr>
<!-- ======================================================================== -->

<ul style="font-size:70%;list-style:none">
    <li id="mouseins_subelements">
        0 mouseins sub-elements
    </li>
    <li id="mouseins_svg">
        0 mouseins svg
    </li>
    <li id="mouseenters">
        0 mouseenters
    </li>
    <li>
        <ul style="list-style:none">
            <li id="mousemoves">
                0 mousemoves
            </li>
            <li>
                <ul style="list-style:none">
                    <li id="mousedowns">
                        0 mousedowns
                    </li>
                    <li>
                        <ul style="list-style:none">
                            <li id="mousedrags">
                                0 mousedrags
                            </li>
                        </ul>
                    </li>
                    <li id="mouseups">
                        0 mouseups
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    <li id="mouseleaves">
        0 mouseleaves
    </li>
    <li id="mouseouts_svg">
        0 mouseouts svg
    </li>
    <li id="mouseouts_subelements">
        0 mouseouts sub-elements
    </li>
</ul>

<button id="copy-button" data-clipboard-text="Copy Me!" title="Click to copy me.">Copy to Clipboard</button>

<pre id="theSource">
(this should get replaced by the svg source code)
</pre>

<!-- decoy, make sure this works -->
<p class="theGraphic">

</body>
</html>



