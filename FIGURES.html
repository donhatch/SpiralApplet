<!DOCTYPE html>
<html>
<head>
    <!--
        TODO: things reverse badly when dragged to unusual orientations
              (with assertion failure in figure 4)

        TODO: text highlights when dragging, make it not do that
        TODO: make it not change into a text cursor when dragging? (when on text too)
        TODO: make it draggable even when in other document!

        TODO: more descriptive than "dragging thing with"
        TODO: constraints, so _d can't be to right of ^d, etc.
        TODO: show values somewhere on screen instead of console log
        TODO: make drag handle bigger on hover

        TODO: doesn't detect mouse clicks in firefox?

        TODO: parametrize the figure, going to use it 3 times


    -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Figures for The Spiral Moment Lemma: There's No Single-Exit Lagoon</title>
    <style type="text/css">
        body {font-size:large;}
        /* "smaller" seems to mean 80% */
        #theSource {font-size: 58.119653701782230115213678800500929355622%;} /* minimum that stays black instead of turning gray */

        div.figure {
            width:60%; /* XXX ARGH! don't want to have to do this! */
            margin:auto;
            outline: 1px dashed #d0d0d0;
        }
        svg.figure {
            outline: 1px dashed black;
        }

        text {
            /* make it so the text doesn't get highlighted
               if the mouse is over it during dragging,
               since that got pretty distracting.
               the user-select one is commented out because it provokes a warning in firefox.
               */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            /* user-select: none; */

            /* fill: green; */
        }
    </style>

    <!-- 1.9.1 provokes warnings in firefox:
         Unknown property 'box-sizing'. Declaration dropped.
         :-(
    -->
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>


    <script>
	// make $ not be an alias for jQuery
        // since I think that's ridiculous
        jQuery.noConflict();
    </script>

    <script src="ZeroClipboard.js"></script>
    <script src="initFigureInteraction.js"></script> <!-- do NOT self-close, that causes weirdness -->
    <script src="vertexColoredPath.js"></script>

    <script>
        jQuery(document).ready(function() {
            console.log("in jquery document-ready function!");

            var templateDiv = jQuery('#figureTemplateDiv');
            var templateSVG = templateDiv.children();
            var theSource = jQuery('#theSource');
            var theButton = jQuery('#copy-button');


            if (true)
            {
                console.log("jQuery('.vertexColoredPath') = ",jQuery('.vertexColoredPath'));
                setupVertexColoredPaths(jQuery('.vertexColoredPath'));
                // do it twice to test
                console.log("(setting up colored paths again)");
                setupVertexColoredPaths(jQuery('.vertexColoredPath'));
            }


            if (true)
            {
                initFigures567Interaction(function() {
                    var templateDivClone = templateDiv.clone();
                    templateDivClone.find('.vertexColoredPathSegments').prev().show(0);
                    templateDivClone.find('.vertexColoredPathSegments').remove();
                    var innerHTML = "    "+jQuery.trim(templateDivClone.html());
                    
                    // this gets called when the svg source changes
                    //theSource.text("    "+jQuery.trim(templateDiv[0].innerHTML));
                    theSource.text(innerHTML);
                    console.log("setting text for copy-to-clipboard button");
                    theButton.attr('data-clipboard-text', "    "+innerHTML);
                });
            }

            if (true)
            {
                // NOTE ZeroClipboard only works over a web server
                // (not via file://).
                // To start a web server:
                //     python -m SimpleHTTPServer
                var clip = new ZeroClipboard( document.getElementById("copy-button"), { moviePath: "ZeroClipboard.swf" } );
                clip.on('complete', function(client,args) {
                    console.log("Copied "+theButton.attr('data-clipboard-text').length+" bytes of text to clipboard");
                });
            }
            console.log("out jquery document-ready function!");
        }); // jquery document ready function
    </script>
</head>
<body>
<p>
<ul id="assertOutputList"></ul>  
<p>
<!-- ======================================================================== -->
<hr>
<div id="figure4div" class="figure" width="450" height="330">
    <svg class="figure" xmlns="http://www.w3.org/2000/svg" version="1.1" width="450" height="330">
        <g class="theGraphic" transform="translate(150,300) scale(200,-200)">
           
            <!-- note, the super-light gray here might not be appropriate for printing or most displays; my display maybe isn't like most -->
            <path class="yAxis" vector-effect="non-scaling-stroke" style="stroke:#f0f0f0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 1 L 0 0"></path>

            <path class="p0p1DottedPath" vector-effect="non-scaling-stroke" style="stroke:#e0e0e0; stroke-width:2; stroke-dasharray:5,5; fill:none"
                d="M .8 .6 L 0 0 L .8 1.0"/>

            <path class="dudleyNeighborsPath vertexColoredPath" vector-effect="non-scaling-stroke" style="stroke-width: 2px; fill: none; stroke-opacity: 1"
                stroke="rgb(128,128,255)"
                d=" M 0 0 L 1.25 .2 L 1 0 M 0 0 L .75 -.125 L 1 0" vertex-opacities=".5 0 .5 .5 0 .5"></path>
            <path class="dudleyMainPath" vector-effect="non-scaling-stroke" style="stroke: blue; stroke-width: 4; fill: none; stroke-miterlimit:1.414" d="M 0 0 L 1 0"/>

            <path class="priscillaNeighborsPath vertexColoredPath" vector-effect="non-scaling-stroke" style="stroke-width: 2px; fill: none; stroke-opacity: 1; "
                stroke="red"
                d=" M .75 1.4 L .8 1.0 L .9 .8  M .75 .2 L .8 .6 L .9 .3"
                vertex-opacities=" 0 0.5 0 0 0.5 0"/>
            <path class="priscillaMainPath" vector-effect="non-scaling-stroke" stroke="red" stroke-opacity="1" style="stroke-width: 4; fill: none"
                d="M .8 .6 L .8 1.0"/>

                
            <g class="p0transform" transform="translate(.8,.6)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle class="priscillaPoint0" cx="0" cy="0" r="3" style="stroke: red; fill: white;"></circle>
                    <g transform="translate(8,-6)">
                        <text class="p0text">
                            <tspan x="0" y="0">p</tspan>
                            <tspan x="0" y="3">_</tspan>
                        </text>
                    </g>
                </g>
            </g>
            <g class="p1transform" transform="translate(.8,1.0)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle class="priscillaPoint1" cx="0" cy="0" r="3" style="stroke: red; fill: white;"></circle>
                    <g transform="translate(6,-6)">
                        <text class="p0text">
                            <tspan x="0" y="0">p</tspan>
                            <tspan x="0" y="-15">_</tspan>
                        </text>
                    </g>
                </g>
            </g>
            <g transform="translate(0,0)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(-10,15)">
                        <text>0</text>
                    </g>
                </g>
            </g>

            <g class="dtransform" transform="translate(1,0)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(4,12)">
                        <text class="dtext">d</text>
                    </g>
                </g>
            </g>

        </g>
    </svg>
</div>
<br>
Figure 4
<hr>
<div id="figure5div" class="figure" width="450" height="330">
    (placeholder -- this should get replaced by the figure 5 svg)
</div>
<br>
Figure 5
<hr>
<div id="figure6div" class="figure" width="450" height="330">
    (placeholder -- this should get replaced by the figure 6 svg)
</div>
<br>
Figure 6
<hr>
<div id="figure7div" class="figure" width="450" height="330">
    (placeholder -- this should get replaced by the figure 7 svg)
</div>
<br>
Figure 7
<hr>
<div id="figureTemplateDiv" class="figure" width="450" height="330">
        <svg class="figure" xmlns="http://www.w3.org/2000/svg" version="1.1" width="450" height="330">
<!--?xml version="1.0" standalone="no"?-->
        <g class="theGraphic" transform="translate(150,300) scale(200,-200)">
           
            <!-- note, the super-light gray here might not be appropriate for printing or most displays; my display maybe isn't like most -->
            <path class="yAxis" vector-effect="non-scaling-stroke" style="stroke:#f0f0f0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 1 L 0 0"></path>

            <g class="arcsStuff">
                <path class="m1arc" vector-effect="non-scaling-stroke" style="stroke:#e0e0e0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 0 L 0.056920997883030844 0.01897366596101028 A0.06000000000000002,0.06000000000000002 0 0,1 0,0.06000000000000002 L 0 0"></path>
                <path class="m2arc" vector-effect="non-scaling-stroke" style="stroke:#e0e0e0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 0 L 0.19200000000000006 0.14400000000000007 A0.24000000000000007,0.24000000000000007 0 0,1 0,0.24000000000000007 L 0 0"></path>
                <path class="m3arc" vector-effect="non-scaling-stroke" style="stroke:#e0e0e0; stroke-width:2; fill: none; stroke-opacity:1" d="M 0 0.10000000000000003 L 0.056920997883030844 0.1189736659610103 A0.06000000000000002,0.06000000000000002 0 0,1 0,0.16000000000000006 L 0 0.10000000000000003"></path>
            </g>
            <g class="dhatStuff"> <!-- note there's more than one dhatStuff -->
                <path class="dhatDottedPath" vector-effect="non-scaling-stroke" style="stroke:#808080; stroke-width:2; stroke-dasharray:5,5; fill: none; stroke-opacity:1" d="M 0.6000000000000001 0.2 L 0.6000000000000001 0.4500000000000001"></path>
            </g>

            <g class="orthoDottedPathStuff">
                <path class="orthoDottedPath" vector-effect="non-scaling-stroke" style="stroke:#808080; stroke-width:2; stroke-dasharray:5,5; fill: none; stroke-opacity:1" d="M 0 0 L 0.8 0 L 0.8 0.6000000000000001 M 0 0 L 0.6000000000000001 0 L 0.6000000000000001 0.2"></path>
            </g>

            <path class="dudleyNeighborsPath" stroke-miterlimit="100000" vector-effect="non-scaling-stroke" style="stroke-width: 2px; fill: none;" stroke="rgb(128,128,255)" stroke-opacity="1" d=" M 0.8 0.6000000000000001 L 0.9000000000000001 1.3000000000000003 L 0 0 M 0.6000000000000001 0.2 L 0.4000000000000001 -5.551115123125783e-17 L 0 0" vertex-opacities=" 1 0 1 1 0 1"></path>

            <path class="dudleyMainPath" vector-effect="non-scaling-stroke" style="stroke: blue; stroke-width: 4; fill: none; stroke-miterlimit:1.414" d="M 0 0 L 0.6000000000000001 0.2 L 0.8 0.6000000000000001 L 0 0"></path>
            <path class="priscillaNeighborsPath" vector-effect="non-scaling-stroke" style="stroke-width: 2px; fill: none; stroke-opacity: 1;" stroke="red" d=" M -2.160000000000001 2.88 L -0.6000000000000003 1.8 L 0.3899494936611664 1.6585786437626908 M 0.3630852169962633 0.3035814496704034 L 0.1666666666666667 0.49999999999999994 L 0.16666666666666669 0.22222222222222215 M 0.47140452079103173 0.7642977396044842 L 0.7071067811865476 0.6464466094067263" vertex-opacities=" 0 0.5 0 0 0.5 0 1 0"></path>
            <path class="priscillaMainPath" vector-effect="non-scaling-stroke" stroke="red" stroke-opacity="1" style="stroke-width: 2; fill: none" d="M 0.1666666666666667 0.49999999999999994 L 0 1 L -0.6000000000000003 1.8 M 0 1 L 0.47140452079103173 0.7642977396044842"> </path>

                
            <g class="ptransform" transform="translate(0,1)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle class="priscillaPoint" cx="0" cy="0" r="4" style="stroke-width:2; stroke: red; fill: white;"></circle>
                    <g transform="translate(10,-10)">
                        <text>p</text>
                    </g>
                </g>
            </g>
            <g transform="translate(0,0)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(-10,15)">
                        <text>0</text>
                    </g>
                </g>
            </g>

            <g class="dhatStuff"> <!-- note there's more than one dhatStuff -->
                <g class="dhattransform" transform="translate(0.6000000000000001,0.4500000000000001)">
                    <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                        <circle cx="0" cy="0" r="4" style="stroke:none;fill:blue"></circle>
                        <g transform="translate(-15,0)">
                            <text class="d0text">
                                <tspan x="0" y="0">d</tspan>
                                <tspan x="1" y="-9">^</tspan>
                            </text>
                        </g>
                    </g>
                </g>
            </g>

            <g class="d0transform" transform="translate(0.6000000000000001,0.2)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(5,10)">
                        <text class="d0text">
                            <tspan x="0" y="0">d</tspan>
                            <tspan x="0" y="0">_</tspan>
                        </text>
                    </g>
                </g>
            </g>
            <g class="d1transform" transform="translate(0.8,0.6000000000000001)">
                <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                    <circle cx="0" cy="0" r="3" style="stroke:blue;fill:white"></circle>
                    <g transform="translate(10,5)">
                        <text class="d1text">
                            <tspan x="0" y="0">d</tspan>
                            <tspan x="0" y="-19">_</tspan>
                        </text>
                    </g>
                </g>
            </g>
            <g class="orthoDottedPathStuff">
                <g class="xd0transform" transform="translate(0.6000000000000001,0)">
                    <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                        <g transform="translate(-15,17)">
                            <text class="xd0text">
                                <tspan>x</tspan><tspan dy="5" font-size="70%">d</tspan>
                                <tspan x="0" y="3">_</tspan>
                                <tspan x="6" y="3">_</tspan>
                            </text>
                        </g>
                    </g>
                </g>
                <g class="xd1transform" transform="translate(0.8,0)">
                    <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                        <g transform="translate(0,17)">
                            <text class="xd1text">
                                <tspan>x</tspan><tspan dy="5" font-size="70%">d</tspan>
                                <tspan x="0" y="-15">_</tspan>
                                <tspan x="6" y="-15">_</tspan>
                            </text>
                        </g>
                    </g>
                </g>
            </g>

        </g>
    </svg>
</div> <!-- figureTemplateDiv -->
<br>
Figures 5,6,7 template (all elements that appear in any of them).
<hr>
<div id="vertexColoredPathTestDiv" class="figure" width="400" height="400">
    <svg class="figure" xmlns="http://www.w3.org/2000/svg" version="1.1" width="400" height="400">
        <defs>
            <linearGradient id="testGradient" gradientUnits="userSpaceOnUse" x1="0" x2="1" y1="0" y2="0">
                <stop offset="0%" stop-color="red"/>
                <stop offset="50%" stop-color="black" stop-opacity="0"/>
                <stop offset="100%" stop-color="blue"/>
            </linearGradient>
            <linearGradient id="blueGradient" gradientUnits="userSpaceOnUse" x1="0" x2="1" y1="0" y2="0">
                <stop offset="0%" stop-color="blue" stop-opacity="0"/>
                <stop offset="100%" stop-color="blue" stop-opacity="1"/>
            </linearGradient>
        </defs>
        <g class="theGraphic" transform="translate(200,100) scale(200,-200)">
            <g display="block">
                <path class="testPath" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none; stroke-opacity:1"
                    stroke="url(#testGradient)"
                    transform="matrix(.5,.5, -.5,.5, .5,.5)"
                    d="M 0 0 L 1 0";

                ></path>
                <g transform="translate(-.5,0)">
                    <g transform="scale(.25)">
                        <path class="vertexColoredPath" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            stroke="url(#testGradient)"
                            stroke-opacity="1"
                            vertex-colors="red yellow green cyan blue magenta red"
                            vertex-opacities="0 1 0 1 0 1 0"
                            d="M 1 0 L .5 .866 L -.5 .866 L -1 0 L -.5 -.866 L .5 -.866 L 1 0"
                        ></path>
                    </g>
                    <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                        <text transform="translate(-30,0)">vert rgba</text>
                    </g>
                </g>
                <g transform="translate(0,0)">
                    <g transform="scale(.25)">
                        <path class="vertexColoredPath" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            stroke="url(#testGradient)"
                            stroke-opacity=".25"
                            vertex-colors="red yellow green cyan blue magenta red"
                            d="M 1 0 L .5 .866 L -.5 .866 L -1 0 L -.5 -.866 L .5 -.866 L 1 0"
                        ></path>
                    </g>
                    <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                        <text transform="translate(-30,0)">vert rgb</text>
                    </g>
                </g>
                <g transform="translate(.5,0)">
                    <g transform="scale(.25)">
                        <path class="vertexColoredPath" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            stroke="red"
                            stroke-opacity="url(#testGradient)"
                            vertex-opacities="1 0 1 0 1 0 1"
                            d="M 1 0 L .5 .866 L -.5 .866 L -1 0 L -.5 -.866 L .5 -.866 L 1 0"
                        ></path>
                    </g>
                    <g class="undoScaleForSvgText" transform="scale(0.005,-0.005)">
                        <text transform="translate(-30,0)">vert alpha</text>
                    </g>
                </g>


                <linearGradient id="anotherGradient">
                    <stop offset="0%" stop-color="green" stop-opacity="1"/>
                    <stop offset="100%" stop-color="red" stop-opacity="1"/>
                </linearGradient>
                <linearGradient id="yetAnotherGradient" gradientUnits="userSpaceOnUse" x2="1">
                    <stop offset="0%" stop-color="green" stop-opacity="1"/>
                    <stop offset="100%" stop-color="red" stop-opacity="1"/>
                </linearGradient>

                <g transform="translate(-.5,-.5)">
                    <g transform="scale(.25)">
                        <path stroke="url(#anotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            d="M 0 0 L 1 1"/>
                        <path stroke="url(#anotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            d="M 1.5 1 L .5 0"/>
                        <path stroke="url(#anotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            d="M 0 1 L 1 0"/>
                        <path stroke="url(#anotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            d="M 1.5 0 L 0.5 1"/>
                    </g>
                </g>
                <g transform="translate(0,-.5)">
                    <g transform="scale(.25)">
                        <path stroke="url(#yetAnotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            transform="matrix(1,1 -1,1 0,0)"
                            d="M 0 0 L 1 0"/>
                        <path stroke="url(#yetAnotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            transform="matrix(-1,-1 1,-1 1.5,1)"
                            d="M 0 0 L 1 0"/>
                        <path stroke="url(#yetAnotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            transform="matrix(1,-1 1,1 0,1)"
                            d="M 0 0 L 1 0"/>
                        <path stroke="url(#yetAnotherGradient)" vector-effect="non-scaling-stroke" style="stroke-width:2; fill:none"
                            transform="matrix(-1,1 -1,-1 1.5,0)"
                            d="M 0 0 L 1 0"/>
                    </g>
                </g>

                <!--
                http://stackoverflow.com/questions/381668/can-a-two-dimensional-gradient-be-created-or-faked-in-svg
                -->
                <linearGradient id="blackToGreenNW" gradientUnits="userSpaceOnUse" x1="0" y1="0" x2=".5" y2=".5">
                    <stop offset="0%" stop-color="black" stop-opacity="1"/>
                    <stop offset="100%" stop-color="green" stop-opacity="1"/>
                </linearGradient>
                <linearGradient id="transparentToBlueN" gradientUnits="userSpaceOnUse" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stop-color="blue" stop-opacity="0"/>
                    <stop offset="100%" stop-color="blue" stop-opacity="1"/>
                </linearGradient>
                <g transform="translate(-.5,-1.25)">
                    <g transform="scale(.5)">
                        <path stroke="none" fill="url(#blackToGreenNW)" d="M 0 0 L 1 0 L 0 1"/>
                        <path stroke="none" fill="url(#transparentToBlueN)" d="M 0 0 L 1 0 L 0 1"/>
                    </g>
                </g>
            </g>
        </g>
    </svg>
</div> <!-- vertexColoredPathTestDiv -->
<br>
Test of vertex-colored paths.
<hr>

<!-- ======================================================================== -->

<ul style="font-size:70%;list-style:none">
    <li id="mouseins_subelements">
        0 mouseins sub-elements
    </li>
    <li id="mouseins_svg">
        0 mouseins svg
    </li>
    <li id="mouseenters">
        0 mouseenters
    </li>
    <li>
        <ul style="list-style:none">
            <li id="mousemoves">
                0 mousemoves
            </li>
            <li>
                <ul style="list-style:none">
                    <li id="mousedowns">
                        0 mousedowns
                    </li>
                    <li>
                        <ul style="list-style:none">
                            <li id="mousedrags">
                                0 mousedrags
                            </li>
                        </ul>
                    </li>
                    <li id="mouseups">
                        0 mouseups
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    <li id="mouseleaves">
        0 mouseleaves
    </li>
    <li id="mouseouts_svg">
        0 mouseouts svg
    </li>
    <li id="mouseouts_subelements">
        0 mouseouts sub-elements
    </li>
</ul>

<button id="copy-button" data-clipboard-text="Copy Me!" title="Click to copy me.">Copy to Clipboard</button>

<pre id="theSource">
(this should get replaced by the svg source code the first time it changes)
</pre>

<!-- decoy, make sure this works -->
<p class="theGraphic">

</body>
</html>



